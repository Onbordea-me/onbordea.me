<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Onbordea.me</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Mapbox GL CSS -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
  #map {
    width: 100%;
    height: 100%;
    border-radius: 0.375rem;
  }

  .map-wrapper {
    position: relative;
    height: 400px;
    border-radius: 0.5rem;
    overflow: hidden;
  }

  #search-container {
    position: absolute;
    top: 12px;
    left: 12px;
    z-index: 10;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 0.375rem;
    padding: 0.5rem;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
  }

  #search {
    padding: 6px 10px;
    width: 180px;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    font-size: 0.875rem;
  }
</style>

  </head>
  <body class="bg-gray-50">
    <div class="flex h-screen overflow-hidden">
      <!-- Sidebar -->
      <aside id="sidebar" class="w-20 bg-gray-900 text-white flex flex-col items-center py-4 space-y-6 transition-all duration-300">
        <!-- Logo -->
        <a href="index.html" >
          <img src="../../assets/logo.png" alt="Logo" />
        </a>

        <!-- Navigation -->
        <nav id="sidebar-nav" class="flex flex-col items-center space-y-6 mt-4 w-full">
          <a href="employees.html" class="flex items-center space-x-2 py-1 rounded hover:bg-gray-800 transition">
            <span>üë•</span><span class="sidebar-label hidden">Employees</span>
          </a>
          <a href="equipment.html" class="flex items-center space-x-2 py-1 rounded hover:bg-gray-800 transition">
            <span>üì¶</span><span class="sidebar-label hidden">Equipment</span>
          </a>
          <a href="requests.html" class="flex items-center space-x-2 py-1 rounded hover:bg-gray-800 transition">
            <span>üì¨</span><span class="sidebar-label hidden">Requests</span>
          </a>
          <a href="analytics.html" class="flex items-center space-x-2 py-1 rounded hover:bg-gray-800 transition">
            <span>üìä</span><span class="sidebar-label hidden">Analytics</span>
          </a>
          <a href="reports.html" class="flex items-center space-x-2 py-1 rounded hover:bg-gray-800 transition">
            <span>üóÇÔ∏è</span><span class="sidebar-label hidden">Reports</span>
          </a>
          <a href="settings.html" class="flex items-center space-x-2 py-1 rounded hover:bg-gray-800 transition">
            <span>üõ∞Ô∏è</span><span class="sidebar-label hidden">Settings</span>
          </a>
          <a href="support.html" class="flex items-center space-x-2 py-1 rounded hover:bg-gray-800 transition">
            <span>üåê</span><span class="sidebar-label hidden">Support</span>
          </a>
        </nav>
      </aside>

      <!-- Main Content -->
      <div class="flex-1 flex flex-col">
        <!-- Top Navbar -->
        <header class="flex items-center justify-between px-6 py-4 bg-white shadow">
          <div class="flex items-center space-x-4">
            <button id="sidebar-toggle" class="text-gray-600 text-xl">‚ò∞</button>
            <input type="text" placeholder="Search..." class="px-3 py-1 border rounded-md text-sm focus:outline-none" />
            <button class="bg-indigo-500 text-white px-4 py-1 rounded text-sm">Search</button>
          </div>
          <div class="flex items-center space-x-4">
            <span>üîî</span>
            <span class="flex items-center space-x-2">
              <img src="https://via.placeholder.com/30" class="rounded-full" />
              <span class="text-sm">Marcos Cohen</span>
            </span>
          </div>
        </header>

        <!-- Dashboard + Map -->
        <main class="bg-white p-6 rounded shadow flex flex-col gap-6 overflow-auto">
          <!-- Dashboard Overview -->
          <div class="flex justify-between items-start flex-wrap gap-4">
            <div class="flex gap-4">
              <div class="bg-blue-100 text-blue-900 p-4 rounded shadow w-40">
                <p class="text-sm font-semibold">Empleados Activos</p>
                <p class="text-2xl font-bold">25</p>
              </div>
              <div class="bg-white p-4 rounded shadow w-40">
                <p class="text-sm font-semibold">Tickets Abiertos</p>
                <p class="text-2xl font-bold">3</p>
              </div>
              <div class="bg-white p-4 rounded shadow w-40">
                <p class="text-sm font-semibold">Tickets en Proceso</p>
                <p class="text-2xl font-bold">6</p>
              </div>
              <div class="bg-white p-4 rounded shadow w-56">
                <p class="text-sm font-semibold">√öltimos Movimientos</p>
                <p class="text-sm mt-1 text-gray-700">Offboarding solicitado<br/>2 empleados</p>
              </div>
            </div>
            <button id="openRequestModalBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 text-sm">
              + Nuevo Pedido
            </button>
          </div>

          <!-- Alert Message -->
          <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-4 rounded shadow text-sm">
            ‚ö†Ô∏è Entrega demorada para Juan P√©rez
          </div>

          <!-- Tickets Table -->
          <div>
            <h3 class="text-lg font-semibold mb-2">Tickets Recientes</h3>
            <div class="overflow-auto">
              <table class="min-w-full text-sm bg-white border border-gray-200 rounded shadow">
                <thead class="bg-gray-100 text-gray-700 font-semibold">
                  <tr>
                    <th class="px-4 py-2 text-left">Tipo</th>
                    <th class="px-4 py-2 text-left">Empleado</th>
                    <th class="px-4 py-2 text-left">Estado</th>
                    <th class="px-4 py-2 text-left">Fecha de Creaci√≥n</th>
                    <th class="px-4 py-2 text-left">Fecha de Actualiz.</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="border-t">
                    <td class="px-4 py-2">Onboarding</td>
                    <td>
                      <button class="text-blue-600 hover:underline employee-detail-btn" data-id="123" data-name="Anna Martinez" data-country="USA">
                        Anna Martinez
                      </button>
                    </td>
                    <td class="px-4 py-2"><span class="bg-yellow-200 text-yellow-800 px-2 py-1 rounded text-xs">En preparaci√≥n</span></td>
                    <td class="px-4 py-2">24 abr 2024</td>
                    <td class="px-4 py-2">25 abr 2024</td>
                  </tr>
                  <tr class="border-t">
                    <td class="px-4 py-2">Offboarding</td>
                    <td>
                      <button class="text-blue-600 hover:underline employee-detail-btn" data-id="123" data-name="Anna Martinez" data-country="USA">
                        Laura Sanchez
                      </button>
                    </td>
                    <td class="px-4 py-2"><span class="bg-blue-200 text-blue-800 px-2 py-1 rounded text-xs">Solicitado</span></td>
                    <td class="px-4 py-2">23 abr 2024</td>
                    <td class="px-4 py-2">23 abr 2024</td>
                  </tr>
                  <tr class="border-t">
                    <td class="px-4 py-2">Mantenimiento</td>
                    <td>
                      <button class="text-blue-600 hover:underline employee-detail-btn" data-id="123" data-name="Anna Martinez" data-country="USA">
                        Juan Gonzalez
                      </button>
                    </td>
                    <td class="px-4 py-2"><span class="bg-green-200 text-green-800 px-2 py-1 rounded text-xs">En proceso</span></td>
                    <td class="px-4 py-2">22 abr 2024</td>
                    <td class="px-4 py-2">24 abr 2024</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Map -->
          <div class="mt-4 flex-1 relative min-h-[400px]">
            <h2 class="font-semibold mb-2">Employee Map</h2>
            <div class="map-wrapper">
            <div id="search-container">
              <input type="text" id="search" placeholder="Search employees..." autocomplete="off" />
            </div>
            <div id="map"></div>
          </div>
        </main>
      </div>
    </div>

        <div id="newRequestModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-lg p-6 w-full max-w-lg shadow-lg">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-semibold">Nuevo Pedido</h2>
          <button id="closeRequestModalBtn" class="text-gray-500 hover:text-gray-700">&times;</button>
        </div>

        <form id="newRequestForm" class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium">Tipo de Pedido</label>
              <select name="tipo" class="w-full border rounded px-3 py-2" required>
                <option value="Onboarding">Onboarding</option>
                <option value="Offboarding">Offboarding</option>
                <option value="Mantenimiento">Mantenimiento</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium">Pa√≠s</label>
              <input type="text" name="pais" class="w-full border rounded px-3 py-2" placeholder="Ej: USA" required />
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium">Nombre del Empleado</label>
              <input type="text" name="nombre" class="w-full border rounded px-3 py-2" required />
            </div>

            <div>
              <label class="block text-sm font-medium">Tel√©fono</label>
              <input type="text" name="telefono" class="w-full border rounded px-3 py-2" />
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium">Direcci√≥n Email</label>
            <input type="email" name="email" class="w-full border rounded px-3 py-2" required />
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium">Tipo de Equipo</label>
              <input type="text" name="equipo" class="w-full border rounded px-3 py-2" />
            </div>

            <div>
              <label class="block text-sm font-medium">Software Requerido</label>
              <select name="software" class="w-full border rounded px-3 py-2">
                <option value="">Seleccione</option>
                <option value="Office Suite">Office Suite</option>
                <option value="Design Tools">Design Tools</option>
                <option value="Antivirus">Antivirus</option>
              </select>
            </div>
          </div>

          <div class="flex justify-end space-x-2 pt-4">
            <button type="button" id="closeRequestModalBtn2" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Cancelar</button>
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Crear Pedido</button>
          </div>
        </form>
      </div>
    </div>

 
    <!-- Mapbox JS -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
    <script>
      mapboxgl.accessToken = 'pk.eyJ1Ijoib25ib3JkZWEiLCJhIjoiY21icXM3aDI3MDJvOTJrcHZqenp3bW1wOSJ9.lQcEYdGkOfDzQe4Sl8L3TQ';
      const employees = [
        { name: 'Alice Smith', role: 'Manager', lat: -34.6037, lng: -58.3816 },
        { name: 'Bob Johnson', role: 'Technician', lat: -23.5505, lng: -46.6333 },
        { name: 'Charlie Brown', role: 'Sales', lat: -12.0464, lng: -77.0428 },
      ];

      const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v12',
        center: [-47.9292, -15.7801],
        zoom: 4,
      });

      let markers = [];

      function addMarkers(data) {
        markers.forEach(({ marker }) => marker.remove());
        markers = [];
        data.forEach((emp) => {
          const el = document.createElement('div');
          el.className = 'marker';
          el.style.backgroundImage = 'url(https://docs.mapbox.com/mapbox-gl-js/assets/custom_marker.png)';
          el.style.width = '30px';
          el.style.height = '40px';
          el.style.backgroundSize = '100%';

          const marker = new mapboxgl.Marker(el)
            .setLngLat([emp.lng, emp.lat])
            .setPopup(new mapboxgl.Popup({ offset: 25 }).setHTML(`<strong>${emp.name}</strong><br/>Role: ${emp.role}`))
            .addTo(map);

          markers.push({ marker, data: emp });
        });
      }

      addMarkers(employees);

      const searchInput = document.getElementById('search');
      searchInput.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        const filtered = employees.filter((emp) => emp.name.toLowerCase().includes(query));
        addMarkers(filtered);
      });
    </script>

    <script>
  const newRequestModal = document.getElementById('newRequestModal');
  const openRequestModalBtn = document.getElementById('openRequestModalBtn');
  const closeRequestModalBtn = document.getElementById('closeRequestModalBtn');
  const closeRequestModalBtn2 = document.getElementById('closeRequestModalBtn2');
  const newRequestForm = document.getElementById('newRequestForm');

  openRequestModalBtn.addEventListener('click', () => newRequestModal.classList.remove('hidden'));
  closeRequestModalBtn.addEventListener('click', () => newRequestModal.classList.add('hidden'));
  closeRequestModalBtn2.addEventListener('click', () => newRequestModal.classList.add('hidden'));

  newRequestForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(newRequestForm);
    const data = {
      tipo: formData.get('tipo'),
      pais: formData.get('pais'),
      nombre: formData.get('nombre'),
      telefono: formData.get('telefono'),
      email: formData.get('email'),
      equipo: formData.get('equipo'),
      software: formData.get('software')
    };

    try {
      const res = await fetch('/api/pedidos', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      if (res.ok) {
        alert('Pedido creado exitosamente');
        newRequestModal.classList.add('hidden');
        newRequestForm.reset();
      } else {
        const err = await res.json();
        alert('Error: ' + (err.error || 'No se pudo crear el pedido'));
      }
    } catch (err) {
      alert('Error: ' + err.message);
    }
  });
</script>

<div id="employeeDetailModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg p-6 w-full max-w-2xl shadow-lg">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-semibold">Detalle de Empleado</h2>
      <button id="closeEmployeeModalBtn" class="text-gray-500 hover:text-gray-700">&times;</button>
    </div>

    <div id="employeeDetailContent">
      <div class="flex items-center space-x-4 mb-4">
        <div class="h-12 w-12 bg-gray-300 rounded-full flex items-center justify-center font-semibold text-gray-700">
          <span id="employeeInitials">A</span>
        </div>
        <div>
          <h3 id="employeeName" class="font-medium text-lg">Anna Martinez</h3>
          <p id="employeeCountry" class="text-sm text-gray-500">USA</p>
        </div>
      </div>

      <div>
        <h4 class="font-semibold mb-2">Equipos Asignados</h4>
        <table class="w-full text-sm border">
          <thead>
            <tr class="bg-gray-100">
              <th class="p-2 text-left">Ticket</th>
              <th class="p-2 text-left">Estado</th>
              <th class="p-2 text-left">Fecha</th>
            </tr>
          </thead>
          <tbody id="employeeTickets">
            <!-- Filled by JavaScript -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  const employeeModal = document.getElementById('employeeDetailModal');
  const closeEmployeeModalBtn = document.getElementById('closeEmployeeModalBtn');
  const employeeDetailButtons = document.querySelectorAll('.employee-detail-btn');
  
  const nameEl = document.getElementById('employeeName');
  const countryEl = document.getElementById('employeeCountry');
  const initialsEl = document.getElementById('employeeInitials');
  const ticketsEl = document.getElementById('employeeTickets');

  const mockTicketData = {
    123: [
      { ticket: 'Onboarding', status: 'Completado', date: '1 ene. 2024' },
      { ticket: 'Onboarding', status: 'Pendiente', date: '14 dic. 2023' }
    ],
    // Add more employee IDs as needed
  };

  employeeDetailButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.dataset.id;
      const name = btn.dataset.name;
      const country = btn.dataset.country;

      nameEl.textContent = name;
      countryEl.textContent = country;
      initialsEl.textContent = name.split(' ').map(w => w[0]).join('').toUpperCase();

      const tickets = mockTicketData[id] || [];
      ticketsEl.innerHTML = tickets.map(t => `
        <tr>
          <td class="p-2">${t.ticket}</td>
          <td class="p-2">${t.status}</td>
          <td class="p-2">${t.date}</td>
        </tr>
      `).join('');

      employeeModal.classList.remove('hidden');
    });
  });

  closeEmployeeModalBtn.addEventListener('click', () => {
    employeeModal.classList.add('hidden');
  });
</script>


    <script src="../backend/sidebar.js"></script>
  </body>
</html>
